include:
  - remote: 'https://gitlab.com/clambin/gitlab-ci-templates/raw/master/python-tests.yml'
  - remote: 'https://gitlab.com/clambin/gitlab-ci-templates/raw/master/k3s-docker-build-multiarch.yml'
  - remote: 'https://gitlab.com/clambin/gitlab-ci-templates/-/raw/k3s-dynamic/k3s-deploy.yml'
  - remote: 'https://gitlab.com/clambin/gitlab-ci-templates/raw/master/github.yml'

stages:
  - unittest
  - build
  - release
  - deploy

variables:
  VERSION: '0.6'
  DEPLOYMENT: manifests/deployment.yml
  TARGET_NAMESPACE: media

# Don't run for new tags
workflow:
  rules:
    - if: $CI_COMMIT_TAG
      when: never
    - when: always
